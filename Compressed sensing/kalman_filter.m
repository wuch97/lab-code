% kalman_filter.m

function [s_t,P,s_t_last,P_t_last] = kalman_filter(data,a,c,Q,R,x0,P0)
%N = length(data);

%K = zeros(N,1);
%s_pred = zeros(N,1);
%P = zeros(N,1);

%s_pred(1) = x0;
%P(1) = P0;

%for i = 2:N
    s_t_last=a*x0;
    P_t_last=a^2*P0+Q;
    K = (P_t_last*c) / (c^2*P_t_last + R);
    s_t = s_t_last + K * (data - x0);
    P = P_t_last - K * c*P_t_last
%end

%data = [-59,-60,-55,-56,-56,-56,-57,-57,-59,-61,-57,-57,-57,-57,-57,-58,-57,-61,-57,-61,-59,-61,-60,-60,-59,-57,-56,-58,-58,-57,-57,-57,-57,-57,-60,-58,-61,-60,-60,-60,-57,-57,-57,-57,-58,-57,-58,-57,-58,-57,-58,-61,-58,-61,-62,-61,-61,-57,-57,-57,-57,-58,-57,-58,-57,-58,-61,-61,-60,-60,-58,-57,-57,-57,-57,-58,-58,-58,-58,-60,-61,-60,-57,-57,-57,-57,-57,-58,-58,-57,-57,-57,-60,-57,-60,-60,-59,-60,-57,-56]';
%result = kalman_filter(data,1e-6,4e-4,-60,1);
%i = 1:length(data);
%plot(i,result,'r',i,data,'b');